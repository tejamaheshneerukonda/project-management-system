{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | Project Manager</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="{% static 'css/pages/subscription_plans.css' %}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'core:owner_dashboard' %}">
                <i class="fas fa-project-diagram me-2"></i>Project Manager
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{% url 'core:owner_dashboard' %}">
                    <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="{% url 'core:logout' %}">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold text-white mb-3">{{ title }}</h1>
                    <p class="lead text-muted">Choose the perfect plan for your business needs</p>
                </div>

                <!-- Messages -->
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <!-- Subscription Plans -->
                {% if plans %}
                <div class="row justify-content-center">
                    {% regroup plans by plan_type as plan_groups %}
                    {% for plan_group in plan_groups %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="pricing-card dark-card">
                            <!-- Plan Header -->
                            <div class="pricing-header">
                                <div class="plan-icon">
                                    {% if plan_group.grouper == 'BASIC' %}
                                        <i class="fas fa-rocket"></i>
                                    {% elif plan_group.grouper == 'PROFESSIONAL' %}
                                        <i class="fas fa-briefcase"></i>
                                    {% elif plan_group.grouper == 'ENTERPRISE' %}
                                        <i class="fas fa-crown"></i>
                                    {% endif %}
                                </div>
                                <h3 class="plan-title">{{ plan_group.grouper }}</h3>
                                <p class="plan-subtitle">
                                    {% if plan_group.grouper == 'BASIC' %}
                                        Perfect for small teams
                                    {% elif plan_group.grouper == 'PROFESSIONAL' %}
                                        For growing businesses
                                    {% elif plan_group.grouper == 'ENTERPRISE' %}
                                        For large organizations
                                    {% endif %}
                                </p>
                            </div>

                            <!-- Billing Toggle -->
                            <div class="billing-toggle">
                                <div class="toggle-switch">
                                    {% for plan in plan_group.list %}
                                        {% if plan.billing_cycle == 'MONTHLY' or plan.billing_cycle == 'YEARLY' %}
                                        <label class="toggle-option {% if plan.billing_cycle == 'MONTHLY' %}active{% endif %}" data-plan-id="{{ plan.id }}">
                                            <input type="radio" name="billing_{{ plan_group.grouper }}" value="{{ plan.billing_cycle }}" {% if plan.billing_cycle == 'MONTHLY' %}checked{% endif %}>
                                            <span class="toggle-label">{{ plan.get_billing_cycle_display }}</span>
                                        </label>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Pricing Display -->
                            <div class="pricing-display">
                                {% for plan in plan_group.list %}
                                    {% if plan.billing_cycle == 'MONTHLY' or plan.billing_cycle == 'YEARLY' %}
                                    <div class="price-section {% if plan.billing_cycle == 'MONTHLY' %}active{% endif %}" data-plan="{{ plan.billing_cycle }}">
                                        <div class="price-amount">
                                            <span class="currency">$</span>
                                            <span class="amount">{{ plan.price|floatformat:0 }}</span>
                                        </div>
                                        <div class="price-period">Billed {{ plan.get_billing_cycle_display|lower }}</div>
                                        {% if plan.billing_cycle == 'YEARLY' %}
                                        <div class="savings-badge">
                                            <i class="fas fa-gift"></i> Save ${{ plan.annual_savings }}
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <!-- Features -->
                            <div class="features-section">
                                <div class="features-header">
                                    <h4 class="features-title">
                                        <i class="fas fa-gem me-2"></i>Features
                                    </h4>
                                </div>
                                <div class="features-list">
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>{{ plan_group.list.0.max_users }} Users</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>{{ plan_group.list.0.max_projects }} Projects</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>{{ plan_group.list.0.max_storage_gb }}GB Storage</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>{{ plan_group.list.0.max_api_calls }} API Calls</span>
                                    </div>
                                    {% if plan_group.grouper == 'PROFESSIONAL' or plan_group.grouper == 'ENTERPRISE' %}
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Priority Support</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Advanced Analytics</span>
                                    </div>
                                    {% endif %}
                                    {% if plan_group.grouper == 'ENTERPRISE' %}
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Custom Integrations</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>White Label</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Call to Action -->
                            <div class="cta-section">
                                <button class="cta-button" onclick="selectPlan('{{ plan_group.grouper }}')">
                                    <i class="fas fa-arrow-right me-2"></i>Get Started
                                </button>
                            </div>

                            <!-- Highlighted Feature -->
                            <div class="highlighted-feature">
                                <i class="fas fa-check-circle me-2"></i>
                                {% if plan_group.grouper == 'BASIC' %}
                                    Email Support
                                {% elif plan_group.grouper == 'PROFESSIONAL' %}
                                    Priority Support
                                {% elif plan_group.grouper == 'ENTERPRISE' %}
                                    24/7 Priority Support
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- No Plans -->
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="no-plans-card">
                            <div class="no-plans-content">
                                <i class="fas fa-credit-card fa-3x mb-4"></i>
                                <h3 class="text-white mb-3">No subscription plans found</h3>
                                <p class="text-muted mb-4">Create your first subscription plan to get started.</p>
                                <a href="{% url 'core:create_subscription_plan' %}" class="btn btn-primary btn-lg">
                                    <i class="fas fa-plus me-2"></i>Create First Plan
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Quick Actions -->
                <div class="row mt-5">
                    <div class="col-12">
                        <div class="quick-actions">
                            <div class="row justify-content-center">
                                <div class="col-md-3 mb-3">
                                    <a href="{% url 'core:create_subscription_plan' %}" class="action-btn">
                                        <i class="fas fa-plus fa-2x mb-2"></i><br>
                                        Create New Plan
                                    </a>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <a href="{% url 'core:company_subscriptions' %}" class="action-btn">
                                        <i class="fas fa-users fa-2x mb-2"></i><br>
                                        View Subscriptions
                                    </a>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <a href="{% url 'core:subscription_analytics' %}" class="action-btn">
                                        <i class="fas fa-chart-bar fa-2x mb-2"></i><br>
                                        Analytics
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/pages/subscription_plans.js' %}"></script>
</body>
</html>