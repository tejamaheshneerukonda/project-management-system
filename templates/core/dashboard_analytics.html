{% extends 'base_company_admin.html' %}

{% block title %}{{ title }} - {{ company.name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-chart-line me-2"></i>{{ title }}
                    </h2>
                    <p class="text-muted mb-0">Comprehensive analytics and insights for your company dashboard</p>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="refreshAnalytics()">
                        <i class="fas fa-sync me-1"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0">{{ analytics_data.total_users }}</h4>
                            <p class="mb-0">Total Users</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small><i class="fas fa-arrow-up me-1"></i>+12% from last month</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0">{{ analytics_data.total_projects }}</h4>
                            <p class="mb-0">Total Projects</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-project-diagram fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small><i class="fas fa-arrow-up me-1"></i>+8% from last month</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0">{{ analytics_data.total_departments }}</h4>
                            <p class="mb-0">Departments</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-building fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small><i class="fas fa-minus me-1"></i>No change</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0">{{ analytics_data.total_announcements }}</h4>
                            <p class="mb-0">Announcements</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-bullhorn fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small><i class="fas fa-arrow-up me-1"></i>+15% from last month</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Status Overview -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Project Status Overview
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="progress-circle mx-auto mb-3" style="width: 120px; height: 120px;">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle" stroke="#e9ecef" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                                        <circle class="progress-ring-circle" stroke="#28a745" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.73" stroke-dashoffset="49.01"/>
                                    </svg>
                                    <div class="progress-text">
                                        <h3 class="mb-0">{{ analytics_data.active_projects }}</h3>
                                        <small class="text-muted">Active</small>
                                    </div>
                                </div>
                                <h6>Active Projects</h6>
                                <p class="text-muted">Currently in progress</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="progress-circle mx-auto mb-3" style="width: 120px; height: 120px;">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle" stroke="#e9ecef" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                                        <circle class="progress-ring-circle" stroke="#007bff" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.73" stroke-dashoffset="65.35"/>
                                    </svg>
                                    <div class="progress-text">
                                        <h3 class="mb-0">{{ analytics_data.completed_projects }}</h3>
                                        <small class="text-muted">Completed</small>
                                    </div>
                                </div>
                                <h6>Completed Projects</h6>
                                <p class="text-muted">Successfully finished</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="progress-circle mx-auto mb-3" style="width: 120px; height: 120px;">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle" stroke="#e9ecef" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                                        <circle class="progress-ring-circle" stroke="#ffc107" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.73" stroke-dashoffset="81.68"/>
                                    </svg>
                                    <div class="progress-text">
                                        <h3 class="mb-0">{{ analytics_data.pending_projects }}</h3>
                                        <small class="text-muted">Pending</small>
                                    </div>
                                </div>
                                <h6>Pending Projects</h6>
                                <p class="text-muted">Awaiting approval</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-trending-up me-2"></i>Performance Trends
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>User Growth</span>
                            <span class="text-success">+12%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 75%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Project Completion</span>
                            <span class="text-primary">+8%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 85%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Team Productivity</span>
                            <span class="text-warning">+5%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 92%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>System Uptime</span>
                            <span class="text-info">99.5%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 99%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Charts -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>Monthly Activity
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="monthlyActivityChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-area me-2"></i>User Engagement
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="userEngagementChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-history me-2"></i>Recent Activity
                    </h5>
                </div>
                <div class="card-body p-0">
                    {% if recent_activity %}
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Time</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for activity in recent_activity %}
                                        <tr>
                                            <td>
                                                <small>{{ activity.created_at|date:"M d, H:i" }}</small>
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                                                        {{ activity.assigned_to.username|first|upper }}
                                                    </div>
                                                    <span>{{ activity.assigned_to.username }}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">{{ activity.template.name }}</span>
                                            </td>
                                            <td>
                                                <small class="text-muted">{{ activity.template.description|truncatechars:30 }}</small>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-history fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">No recent activity</h6>
                            <p class="text-muted">Activity will appear here as users interact with the system.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-trophy me-2"></i>Top Performers
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-sm bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">John Smith</h6>
                            <small class="text-muted">Project Manager</small>
                        </div>
                        <div class="ms-auto">
                            <span class="badge bg-warning">95%</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-sm bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                            <i class="fas fa-medal"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Sarah Johnson</h6>
                            <small class="text-muted">Developer</small>
                        </div>
                        <div class="ms-auto">
                            <span class="badge bg-secondary">92%</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-sm bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                            <i class="fas fa-award"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Mike Davis</h6>
                            <small class="text-muted">Designer</small>
                        </div>
                        <div class="ms-auto">
                            <span class="badge bg-success">88%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bell me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="generateReport()">
                            <i class="fas fa-file-alt me-1"></i>Generate Report
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="exportData()">
                            <i class="fas fa-download me-1"></i>Export Data
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="scheduleReport()">
                            <i class="fas fa-clock me-1"></i>Schedule Report
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="viewInsights()">
                            <i class="fas fa-lightbulb me-1"></i>View Insights
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.progress-circle {
    position: relative;
}

.progress-ring {
    transform: rotate(-90deg);
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.avatar-sm {
    width: 32px;
    height: 32px;
    font-size: 12px;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
}

.progress {
    background-color: #e9ecef;
}

@media (max-width: 768px) {
    .table-responsive {
        font-size: 0.875rem;
    }
}
</style>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Monthly Activity Chart
const monthlyActivityCtx = document.getElementById('monthlyActivityChart').getContext('2d');
new Chart(monthlyActivityCtx, {
    type: 'bar',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Projects',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }, {
            label: 'Users',
            data: [8, 15, 7, 12, 9, 11],
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// User Engagement Chart
const userEngagementCtx = document.getElementById('userEngagementChart').getContext('2d');
new Chart(userEngagementCtx, {
    type: 'line',
    data: {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        datasets: [{
            label: 'Active Users',
            data: [65, 59, 80, 81],
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 2,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

function refreshAnalytics() {
    location.reload();
}

function generateReport() {
    showErrorToast('Generate report functionality will be implemented soon.');
}

function exportData() {
    showErrorToast('Export data functionality will be implemented soon.');
}

function scheduleReport() {
    showErrorToast('Schedule report functionality will be implemented soon.');
}

function viewInsights() {
    showErrorToast('View insights functionality will be implemented soon.');
}
</script>
{% endblock %}
{% endblock %}
